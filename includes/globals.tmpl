<script>

  class Events {

    constructor() {
      this.callbacks = {};
    }

    on(event, callback) {
      if (!this.callbacks[event]) this.callbacks[event] = [];
      this.callbacks[event].push(callback);
    }

    fire(event, context) {
      if (this.callbacks[event]) {
        this.callbacks[event].forEach(callback => callback(context));
      }
    }

  };

  const query = new URLSearchParams(window.location.search);
  
  const adblock = window.adblock = {
    runtime: {},
    config: {},
    lib: {},
    api: {},
    query,
    strings: {
      "error--unexpected": {{ get_string("stripe-sorry", "payment-form") | tojson }}
    },
    settings: {
      userid: document.documentElement.dataset.userid || false,
      page: document.documentElement.dataset.page || false,
      locale: {{ locale | tojson }},
    },
    events: new Events(),
  };

  adblock.lib.Events = Events;

  adblock.error = (message) => { alert(message) };

  //backwards compatibility
  adblock.searchParameters = query;
  adblock.settings.language = adblock.settings.locale;
  
</script>
<script src="/js/settings.js"></script>