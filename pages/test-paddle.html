title=Test Paddle
robots=none

<style>
  #overlay {
    display: none;
    justify-content: center;
    align-items: center;
    position: fixed;
    top: 0;
    left: 0;
    height: 100vh;
    width: 100vw;
    z-index: 2147483647;
  }
  #modal {
    padding: 1rem;
    height: 520px;
    width: 840px;
    background: #fff;
    border-radius: 1rem;
    margin-bottom: 8rem;
  }
</style>

<button id="buy">Buy</button>

<div id="overlay">
  <div id="modal">
    <h1>Pretending to make API request...</h1>
    <p>Did the user already have a subscription?</p>
    <button id="yes">Yes</button>
    <button id="no">No</button>
  </div>
</div>

<script src="https://cdn.paddle.com/paddle/v2/paddle.js"></script>

<script>
  const token = "test_b0e15dc1f1e4f20b0fe6396e893";
  const priceId = "pri_01j8m8j8945gk9mv9hxd3ykmtm";
  const buy = document.getElementById("buy");
  const overlay = document.getElementById("overlay");
  const yes = document.getElementById("yes");
  const no = document.getElementById("no");
  let email;

  function eventCallback(event) {
    console.log(event.name, event.data);
    if (event.name == "checkout.customer.created") {
      email = event.data.customer.email;
      document.documentElement.appendChild(overlay);
      overlay.style.display = "flex";
    }
  }

  Paddle.Environment.set("sandbox");
  Paddle.Initialize({token, eventCallback});

  buy.addEventListener("click", () => {
    Paddle.Checkout.open({items: [{priceId}]});
  });

  yes.addEventListener("click", () => {
    window.location.href = `${location.origin}/${adblock.settings.locale}/restore-purchase?email=${email}`;
  });

  no.addEventListener("click", () => {
    overlay.style.display = "none";
  });

</script>